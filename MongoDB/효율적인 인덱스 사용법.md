# 효율적인 인덱스 사용법

[인덱싱 관련 추천 글](https://blog.ull.im/engineering/2019/04/05/mongodb-indexing-strategy.html)

* 몽고DB에서 효과적인 인덱싱 전략을 위해서 가장 중요한 것은 선택성(Selectivity)을 높이는 것임
* 선택성을 높이기 위해서는 보다 좁은 범위의 색인을 갖게함으로써 보다 정확하게 검색을 가능하게 함
	* 예시로 영문 단어의 선택성을 높이기 위해 명사/동사 별로 나누지 않고, 알파벳으로 나누게 함
* 아래의 방법들은 몽고DB에서 효율적인 인덱싱 전략을 위해 사용 가능한 전략들 중 일부임

### 동등 필터에 대한 키를 맨 앞에 표기해야 함

* 몽고DB의 인덱스는 B-Tree 구조로, 동등 조건은 탐색을 위한 인덱스 탐색 범위를 대폭 줄일 수 있음
* 또한, 인덱스를 활용할 때 선행(prefix) 필드만 효율적으로 사용하기에 동등 조건을 선행 필드로 지정함

### 정렬에 사용되는 키는 다중값 필드 앞에 표시해야 함

* 다중값 필드란 배열 형식으로 값 내에 여러 값이 포함되는 형식이며, 이러한 형식에도 인덱싱 적용이 가능함
* 하지만 배열 요소마다 인덱스 항목을 생성하기에 해당 필드의 인덱스가 앞, 중간에 오면 문제가 될 수 있음
* 또한, 몽고DB에서는 다중값 필드에 대해 정렬을 진행하는 경우, 배열에 대한 정렬 순서를 보장할 수 없음
	* 다중값 필드는 하나의 필드가 여러 개의 인덱스 항목으로 분할되기에 어느 것이 우선인지 확실치 않음
* 따라서, 정렬 기능을 사용하기 위해서는 다중값 필드 앞에 해당 키를 선언하여 정렬을 보장할 수 있음

### 다중값 필터에 대한 키는 마지막에 표시해야 함

* 위의 내용과 같이 다중값 필터의 인덱스가 중간에 위치하면, 몽고DB는 인덱스를 효율적으로 스캔할 수 없음
	* 따라서, 결과를 도출하기 위해 메모리에서 추가적인 계산 작업을 진행해야 함
* 결론적으로, 몽고DB의 인덱스는 `동등 조건 -> 범위 조건 -> 다중값 필드` 순서로 읽을 때 가장 효율적임