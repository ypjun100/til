# 인덱스의 종류

* 인덱스를 구축할 때 인덱스 옵션을 지정해 동작 방식을 바꿀 수 있는데, 아래는 가장 일반적인 인덱스 종류임

### 고유 인덱스

```js
> db.users.createIndex(
... 	{ "firstname": 1 },
...     {
...			"unique": true
...		}
...	)
```

* 각 값이 인덱스에 최대 한 번만 나타나도록 보장하며, 여러 도큐먼트에 동일한 인덱스 값을 가질 수 없도록 함
* 위의 경우는 여러 도큐먼트에서 `firstname` 키에 동일한 값을 가질 수 없도록 하기 위한 명령
* 만일 동일한 키를 가진 도큐먼트가 추가된다면, 첫 번째 도큐먼트만 저장되고, 나머지는 오류가 발생함
* 도큐먼트를 생성할 때 자동으로 만들어지는 `_id` 필드는 몽고DB 내부적으로 생성되는 고유 인덱스임

> 도큐먼트에 인덱스 필드가 존재하지 않으면, 인덱스는 그 도큐먼트에 대해 값을 `null`로 저장한다. 따라서, 고유 인덱스를 생성한 뒤에 인덱스 필드가 없는 도큐먼트를 2개 이상 삽입하려고 시도하면, 이미 `null` 값을 갖는 도큐먼트가 존재하기에 오류가 발생한다.

### 복합 고유 인덱스

```js
> db.users.insert({"username": "bob"})
> db.users.insert({"username": "bob", "age": 23})
> db.users.insert({"username": "bob", "age": 24})
> db.users.insert({"username": "bob", "age": 24}) // 오류 발생
```

* 도큐먼트끼리 개별 키는 같은 값을 가질 수 있지만, 인덱스 키의 조합은 인덱스 내에서 최대 한 번만 나타남
* `{"username": 1, "age": 1}`로 고유 인덱스가 지정된 상태에서 동일한 조합이 있으면 오류가 발생함

### 부분 인덱스

```js
> db.users.createIndex(
... 	{ "firstname": 1 },
...     {
...			"unique": true,
...			"partialFilterExpression": {
...				firstname: { $exists: 1 }
...			}
...		}
...	)
```

* 고유 인덱스는 `null`을 값으로 취급하므로, 키가 없는 도큐먼트가 여러 개인 고유 인덱스를 만들 수 없음
* 부분 인덱스는 지정된 조건에 만족하는 도큐먼트에 대해서만 고유 인덱스를 적용시키기 위한 방법임
	* 특정 필드가 있는 도큐먼트에만 인덱스를 적용시켜, 키가 없는 도큐먼트에 대한 예외 처리가 가능함
* 몽고DB의 부분 인덱스는 데이터의 서브셋에만 인덱스가 생성되며, RDBMS의 희소 인덱스와 유사함
* 부분 인덱스는 `partialFilterExpression` 옵션으로 생성하며, 인덱스를 적용할 서브셋을 지정함
	* 부분 인덱스는 반드시 고유할 필요가 없으므로, `unique`를 제거해 고유하지 않도록 만들 수 있음