# 프라이머리 선출 방법

* 복제 셋 멤버는 2초마다 서로 핑을 보내며, 프라이머리가 10초 내에 응답이 없으면 문제가 있다고 판단함
* 이 경우에 프라이머리를 접근 불가능한 상태로 인지하고, 우선순위가 높은 세컨더리에 선출을 요청함
	* 우선순위는 기본적으로 복제 셋 설정에서 직접 지정 가능하며, 기본값은 1로 지정되게 됨
	* 우선순위가 높은 세컨더리가 더 낮은 세컨더리보다 상대적으로 더 빨리 선출될 가능성이 높음

> 만약 우선순위가 비교적 낮은 멤버가 프라이머리가 됐을 때, 우선순위가 더 높은 멤버가 다시 복제 셋에 합류하면(정상 동작으로 하면), 프라이머리였던 비교적 우선순위가 낮은 멤버는 프라이머리 권한을 내려놓고, 해당 권한을 우선순위가 더 높은 멤버에게 전달하게 된다.

* 서컨더리 멤버는 자신이 가장 최신의 oplog(로그)를 가지고 있는지, 투표 자격이 있는지 등을 확인함
* 조건이 맞으면, 자신을 프라이머리로 선출해달라는 요청(Vote Request)을 다른 멤버들에 보내게 됨
* 요청을 받은 멤버들은 다음과 같은 항목들을 토대로 검사를 수행하게 됨

> * 요청을 받은 멤버가 현재 프라이머리로 인식되는 멤버와 통신이 가능한가?
> * 선출되고자 하는 멤버의 복제 데이터가 최신인가?
> * 대신 선출돼야 하는 우선순위가 더 높은 멤버는 없는가?

> 첫 번째 규칙의 경우 선출 요청을 전송한 멤버만 프라이머리와의 통신이 불가능한 것일 수도 있으므로, 요청을 받은 멤버가 프라이머리와 통신이 가능한 경우 받은 요청을 무시하게 된다.

### 우선순위

* 특정 멤버가 얼마나 프라이머리가 되기를 원하는지를 나타내는 지표로, 0과 100 사이 값으로 지정 가능함
* 기본값은 `1`이며, 우선순위를 `0`으로 지정하게 된다면 해당 멤버는 절대 프라이머리가 될 수 없음
* 현재 프라이머리인 요소보다 우선순위가 더 높은 세컨더리가 추가되면 해당 멤버가 프라이머리로 선출됨
	* 이때 프라이머리가 되기 위해서는 다른 복제 셋 멤버와 같은 최신 데이터로 동기화되어야 함