# 객체 및 배열 인덱싱

몽고DB는 도큐먼트 내부 내장 도큐먼트의 내부 필드와 배열에 대한 인덱스를 생성할 수 있도록 허용함
* 내장 필드와 배열 필드는 복합 인덱스에서 최상위 필드와 결합 가능하며, 일반적인 인덱스와 동일하게 동작함

### 내장 도큐먼트 인덱싱하기

```json
{
	"username": "jun",
	"loc": {
		"ip": "1.1.1.1",
		"city": "Busan"
	}
}
```

```js
> db.users.createIndex({"loc.city": 1})
```

* 일반적인 필드에 인덱스와 동일한 방식으로 내장 도큐먼트의 필드에 대한 인덱스를 생성할 수 있음
* `loc`의 서브필드(`loc.city`)에 인덱스를 만들어 해당 필드를 이용하는 쿼리의 속도를 높일 수 있음
* 이때 서브필드를 지정하는 것이 아닌, 도큐먼트 전체를 지정하면, 쿼리도 도큐먼트 필드 전체를 포함해야 함
	* ex) `db.users.find({ "loc": { "ip": "1.1.1.1", "city": "Busan" } })`
	* 위 예시의 경우 쿼리의 도큐먼트와 완전히 동일한 도큐먼트를 검색하게 됨

### 배열 인덱싱하기

```js
> db.blog.createIndex({ "comments.date": 1 })
```

* 배열에서 인덱스를 생성하면, 배열의 특정 요소를 효율적으로 찾을 수 있음
* 배열을 인덱싱하면 배열의 각 요소에 인덱스 항목이 지정되므로, 배열의 요소 수만큼 인덱스 항목이 지정됨
* 따라서, 입력/갱신/제거 작업은 배열 요소가 갱신돼야 하므로, 단일값 인덱스보다 더 부담스러움