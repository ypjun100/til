# 복제 셋 설계 방법

| 복제 셋 내 멤버의 수 | 복제 셋의 과반수 |
| ------------ | --------- |
| 1            | 1         |
| 2            | 2         |
| 3            | 2         |
| 4            | 3         |
| 5            | 3         |
| 6            | 4         |
| 7            | 4         |

* 복제 셋에서 과반수 개념은 복제 셋 내 모든 멤버의 절반보다 많은 것으로 정의되며, 설계를 위한 중요 개념임
* 프라이머리의 선출에는 멤버의 과반수 이상이 필요하며, 그 이상에만 프라이머리 자격을 유지할 수 있음
	* 여러 멤버 노드의 장애로 인해 연결이 끊어지는 경우 멤버의 수가 과반수를 넘지 못할 수 있음
* 과반수는 복제 셋의 구성에 따라 산정되므로, 얼마나 많은 멤버가 다운된 상태인지는 중요하지 않음

> 예를 들어 복제 셋에 멤버가 다섯이고, 그 중 세 개가 다운된다고 가정하자. 살아있는 두 멤버는 복제 셋의 과반수에 미치지 않으므로 (최소 3개이어야 함) 프라이머리를 선출할 수 없다. 만약 둘 중 하나가 프라이머리였다면, 과반수에 미치지 않는다는 것을 알자마자 프라이머리 자격을 포기한다.

> 만약 복제 셋에 두 개의 멤버가 각각 프라이머리, 세컨더리로 구성되어 있다고 했을 때, 두 멤버 중 하나의 멤버가 죽는 경우, 복제 셋 내의 모든 멤버는 즉시 세컨더리로 변경되어 더이상 쓰기 작업을 할 수 있는 상태가 아니게 된다. (이때 멤버가 다시 접속되면 프라이머리를 선정할 수 있기에 이슈가 해결됨)

* 복제 셋에서 과반수 이상일 때만 프라이머리를 선출하는 이유는 데이터 일관성, 고가용성을 보장하기 위함임
* 네트워크 분할이나 장애 상황에서 복제 셋이 분할됐을 때 두 개 이상의 노드 그룹이 동시에 존재할 수 있음
	* 이때 각 노드 그룹의 특정 멤버가 프라이머리가 되는 '스플릿 브레인' 현상이 발생할 수 있음
* 과반수 투표 원칙을 적용하여 과반수가 동의하지 않으면 프라이머리가 선출되지 않으므로 이를 방지 가능함