# 친구, 팔로워 그리고 불편한 관계

* 많은 애플리케이션에서는 사람, 내용, 팔로워, 친구 등을 연결하며, 이 정보를 내장 혹은 참조로 구현 가능함
* 팔로우, 친구 맺기, 찜은 한 사용자가 다른 사람의 알림을 구독하는 발행-구독 시스템으로 단순화할 수 있음
* 따라서 구독자를 저장하는 작업과 이벤트와 관련된 모든 사람에게 알림을 보내는 작업은 능률적이어야 함
	* 이러한 작업은 대규모 사용자 기반에서 핵심적이며, 매우 빈번하고, 대량으로 발생하기 때문임

```json
{
	"_id": ObjectId("..."),
	"username": "batman",
	"following": [
		ObjectId("51250a72d96041c7dca81910"),
		ObjectId("51250a72d96041c7dca81936"),
	]
}
```

* 구독을 구현하는 전형적인 방법 중 하나는 게시자(producer)를 구독자의 도큐먼트에 넣는 방법이 있음
* 구독한 게시자의 활동을 가져오기 위해서는 `following` 필드 배열을 참고하여 각 유저의 정보를 쿼리함

```json
{
	"_id": ObjectId("..."),
	"username": "batman",
	"followers": [
		ObjectId("51250a72d96041c7dca81910"),
		ObjectId("51250a72d96041c7dca81936"),
	]
}
```

* 구독을 구현하는 다른 방법으로, 위 방식처럼 게시자 도큐먼트에 구독자 필드(followers)를 추가할 수 있음
* 이 구조는 게시자가 활동을 할 때마다 알림을 보내야 할 모든 사용자를 한번에 알 수 있다는 이점이 존재함
* 위의 두 방식에서 구독 필드는 반환될 필요가 없고, 사용자 도큐먼트를 더욱 자주 바뀌도록 만듦
	* 이러한 문제는 구독 필드를 정규화하여 구독을 다른 컬렉션에 저장함으로써 단점을 보완할 수 있음