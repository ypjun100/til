# 텍스트 검색을 위한 인덱스

* 문자열에 대해 완전 일치, 정규 표현식을 이용해 쿼리가 가능하지만, 속도가 느리고 언어 특성 반영이 어려움
	* 정규 표현식으로 문자열을 검색하면 쿼리 속도가 느리며, 문법과 같은 언어 특성을 반영하기 어려움
	* 문법의 예시로, 문자열 내에서 단어 entry를 검색할 때 entries의 결과도 포함되어야 함
* text 인덱스는 빠른 텍스트 검색 기능과 토큰화, 정지 단어, 형태소 분석 등 검색 엔진 요구 사항을 지원함

### 텍스트 인덱스 생성

```js
> db.articles.createIndex({ "title": "text", "body": "text" })
```

* 텍스트 인덱스를 생성하기 위해서는 기존 인덱스 형태인 `1` 대신에 문자열 `text`를 입력해야 함
* 키에 순서가 있는 일반적인 복합 인덱스와 달리, 텍스트 인덱스의 각 필드는 모두 동등하게 고려됨
* 이때 가중치(`weight`)를 지정하면 몽고DB가 각 필드에 지정하는 상대적 중요도를 제어할 수 있음

```js
> db.articles.createIndex(
... { "title": "text", "body": "text" },
... { "weights": { "title": 3, "body": 2 } }
... )
```

### 텍스트 검색

```js
> db.articles.find(
... { "$text": { "$search": "impact crater lunar" } }
... )
```

* `$text` 쿼리 연산자를 사용해 text 인덱스가 있는 컬렉션에서 텍스트 검색을 수행할 수 있음
	* 텍스트 쿼리는 컬렉션의 텍스트 인덱스에 모두 적용되어, 모든 텍스트 필드에 대한 검색을 수행함
	* 도큐먼트 내에 제목, 본문 필드가 있을 때, 쿼리는 두 필드 중 하나에 해당 용어를 포함하는 경우를 찾음
* `$text`는 공백과 구두점을 구분 기호로 사용해 검색 문자열을 토큰화하여 모든 토큰의 논리적 OR을 수행함 