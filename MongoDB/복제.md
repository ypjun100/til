# 복제

* 단일 서버로 DB를 구성한다면 서버가 고장나 이용 불가능한 상태가 되어 DB를 제대로 사용할 수 없음
* 복제는 데이터의 동일한 복사본을 여러 서버상에 보관하는 방법이며, 실제 서비스를 배포할 때 권장됨
* 한 대 또는 그 이상의 서버에 이상이 발생해도, 정상적으로 동작하게 하고 데이터를 안전하게 보존함
* 몽고DB는 복제 셋을 생성하여 설정할 수 있으며, 프라이머리 한 대와 세컨더리 서버 여러 대로 구성됨
	* 프라이머리는 클라이언트 요청을 처리하며, 세컨더리 서버는 프라이머리 데이터의 복사본을 가짐
	* 프라이머리 서버에 장애가 발생하면 세컨더리 서버들 중 하나를 프라이머리 서버로 선출함

### 복제 셋 설정

* 운영 환경에서는 항상 복제 셋을 사용하며, 각 멤버(프라이머리, 세컨더리 등)를 별도의 서버에 배치해야 함
* 물리적으로 분리된 서버에 각각 멤버를 지정함으로써, 프로세스의 충돌 즉, 리소스 경합을 방지할 수 있음
	* 리소스 경합이란 여러 프로세스 및 서비스가 제한된 자원을 동시에 사용하려고 할 때 발생하는 충돌임
* 추가적인 복원력을 제공하려면 DNS Seedlist 연결 방식을 사용해 앱이 복제 셋에 연결하는 방법을 지정함
	* DNS Seedlist는 클라이언트가 복제 셋의 멤버 목록을 DNS를 통해 동적으로 받을 수 있는 기술임
	* 몽고DB 3.6 버전부터 지원되며, 연결 문자열에 'mongodb+srv://' 접두사를 사용함

```bash
$ mongod --replSet mdbDefGuide --dbpath ~/data/rs1 --port 27017 --oplogSize 200
$ mongod --replSet mdbDefGuide --dbpath ~/data/rs2 --port 27018 --oplogSize 200
$ mongod --replSet mdbDefGuide --dbpath ~/data/rs3 --port 27019 --oplogSize 200
```

* 위의 명령으로 총 3개의 복제 셋을 생성할 수 있으며, 정상적인 경우 별도의 mongod 프로세스가 실행됨