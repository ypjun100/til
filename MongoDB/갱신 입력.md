# 갱신 입력

```shell
> db.analytics.updateOne({ "url": "/blog" },
... { "$inc": { "pageviews": 1 } },
... { "upsert": true }
... )
```

* 갱신 조건에 맞는 도큐먼트가 존재하지 않을 때 쿼리와 갱신 도큐먼트를 합쳐서 새 도큐먼트를 생성함
	* 이를 설정하기 위해 `upsert` 옵션을 추가하며, 만약 도큐먼트가 존재하면 일반적인 갱신을 수행함
* 이러한 로직을 자바스크립트 코드로 아래와 같이 작성한다면, 두 커넥션이 경쟁 상태가 될 수 있음
	* 도큐먼트가 존재하는지 확인 -> 존재하면 조회 수가 1을 더함 -> 존재하지 않는다면 새 도큐먼트 생성
	* 두 커넥션이 동시에 요청하면 존재하지 않는 도큐먼트에 대해 생성 요청이 두 번 만들어질 수 있음
* 갱신 입력을 사용하면, 코드를 줄이고, 원자성을 가지므로 경쟁 상태를 피할 수 있음