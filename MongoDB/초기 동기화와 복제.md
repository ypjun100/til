# 초기 동기화와 복제

* 동기화는 전체 데이터로 새 멤버를 채우는 초기 동기화, 전체 데이터셋에 변경 사항을 적용하는 복제로 나뉨
* 몽고DB의 복제 셋에 새로운 멤버가 추가될 때 초기 동기화 단계를 거치고, 그 이후에 복제 단계가 수행됨

### 초기 동기화

* 멤버가 시작되어 다른 멤버의 데이터를 복사하기 전, 다른 멤버가 동기화를 하기에 유효한 상태인지 확인함
* 유효하면 다른 멤버의 전체 데이터를 복사하며, 이는 여러 단계에 걸쳐 진행되고 로그에서 확인할 수 있음
* 몽고DB는 먼저 데이터를 모두 삭제한 뒤에 local 데이터베이스를 제외한 모든 데이터베이스를 복제함
	* 이때 기존 멤버에 저장되어 있던 기존 데이터는 복제 작업을 시작하기 전에 삭제됨
* 모든 데이터베이스가 복제되면 mongod는 복제한 멤버의 oplog를 사용해 복제 셋의 현재 상태를 갱신함
	* oplog를 가져와 갱신함으로써 복사가 진행되는 동안 발생한 변경 사항을 적용할 수 있음
* 이때 동기화 중인 멤버의 데이터는 프라이머리의 어느 시점에 존재하는 데이터셋과 정확히 일치해야 함
* 초기 동기화 과정을 완료하면, 일반 동기화 단계 즉, 해당 멤버가 세컨더리가 되게 하는 작업을 하게됨

### 복제

* 몽고DB가 수행하는 두 번째 동기화 유형으로, 세컨더리 멤버는 초기 동기화 후 지속적으로 데이터를 복제함
* 이때 oplog를 복제하게 되며, 동기화 소스에서 oplog를 복사한 후 이러한 작업을 비동기 프로세스에 적용함

> 세컨더리 멤버들은 프라이머리의 oplog를 비동기적으로 가져와 자신의 데이터셋에 연산을 적용한다. 이 동작은 실시간에 가깝게 이뤄지며, 스트리밍 방식을 통해 프라이머리의 oplog에 새로운 변경사항이 있으면 바로 적용하게 된다.