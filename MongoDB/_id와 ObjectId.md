# \_id와 ObjectId

몽고DB의 도큐먼트는 `_id` 키를 가지며, 키 값으로 어떤 데이터형도 올 수 있지만 `ObjectId`가 기본임
* 한 컬렉션에서 모든 도큐먼트는 고유한 `_id` 값을 가지며, 이 값으로 컬렉션 내에서 식별이 가능하게 함

### ObjectIds

* `ObjectId` 클래스는 가벼우면서도, 여러 장비에 걸쳐 전역적으로 고유한 ID를 생성하기 쉽게 설계됨
* 전통적인 Auto-Increment 방법이 아닌, `ObjectId`를 사용하는 것은 몽고DB의 분산 특성 때문임
	* 여러 서버에 걸쳐 자동으로 증가하는 기본 키를 동기화하는 작업은 어렵고 시간이 걸리기 때문임
* 몽고DB는 분산 데이터베이스로 설계됐기 때문에 샤딩된 환경에서 고유 식별자를 생선하는 것이 중요했음

```
0  1  2  3  4  5  6  7  8  9  10  11
타임스탬프     랜덤            카운터   (랜덤 시작 값)
```

* `ObjectId`는 12바이트를 사용하며, 바이트 당 2자리를 사용하여 24자리의 16진수 문자열 표현이 가능함
	* 몽고DB는 내부적으로 `ObjectId`를 문자열 형식으로 관리하지 않으며, 바이트를 그대로 사용함
* `ObjectId`의 첫 4바이트는 1970년 1월 1일부터의 시간을 1/1000초 단위로 저장한 타임 스탬프임
	* 타임스탬프가 맨 처음에 온다는 것은 `ObjectId`가 대략적으로 입력 순서대로 정렬된다는 의미임
	* 서버 간에 시간이 다르거나 완진히 틀려도 `ObjectId`를 생성하는 데에는 영향이 없음
* 타임스탬프의 다음 값인 5바이트는 시스템의 랜덤값, 나머지 3바이트는 충돌을 방지하기 위한 카운터임