# 실행 컨텍스트 스택

```js
const x = 1;

function foo() {
	const y = 2;
	
	function bar() {
		const z = 3;
		console.log(x + y + z);
	}
	bar();
}

foo(); // -> 6
```

* 전역 코드를 평가해 전역 실행 컨텍스트를 생성하고, 함수 호출시 이를 평가해 함수 실행 컨텍스트를 생성함
* 이때 생성된 실행 컨텍스트는 스택 자료구조로 관리되며, 이를 실행 컨텍스트 스택이라고 부름
* 상단의 코드를 실행하면 시간의 흐름에 따라 실행 컨텍스트 스택에 위와 같이 컨텍스트가 추가되고 제거됨

### 1. 전역 코드의 평가와 실행

* 엔진은 가장 먼저 전역 코드를 평가하여 전역 실행 컨텍스트를 생성하고 이를 전역 컨텍스트 스택에 푸시함
* 이때 전역 변수 `x`와 전역 함수 `foo`는 전역 실행 컨텍스트에 등록되며, 이후에 전역 코드가 실행됨

### 2. foo 함수 코드의 평가와 실행

* 함수 `foo`가 호출되면 전역 코드의 실행은 일시 중단되고 코드의 제어권이 `foo` 함수 내부로 이동함
* 엔진은 `foo` 함수의 코드를 평가해 `foo` 함수의 실행 컨텍스트를 생성하고, 실행 컨텍스트 스택에 푸시함
	* 소스 코드 평가 단계에서 `foo` 함수의 지역변수 `y`와 중첩 함수 `bar`를 실행 컨텍스트에 등록함
* 이후에 `foo` 함수 코드가 실행되어 지역 변수 `y`에 값이 할당되고, 중첩 함수 `bar`가 호출됨

### 3. bar 함수 코드의 평가와 실행

* 함수 `bar`가 호출되면 `foo` 함수 코드의 실행은 일시 중단되고 코드의 제어권이 `bar` 함수 내부로 이동함
* 마찬가지로 엔진은 코드를 평가해 `bar` 함수 실행 컨텍스트를 생성하고 실행 컨텍스트 스택에 푸시함
* 이후에 `bar` 함수 코드가 실행되기 시작하여 지역 변수 `z`에 값이 할당되고, 출력 메서드 호출 후에 종료됨

### 4. foo 함수 코드로 복귀

* `bar` 함수가 종료되면 다시 `foo` 함수로 이동하며, 이때 엔진은 실행 컨텍스트를 스택에서 팝하여 제거함

### 5. 전역 코드로 복귀

* `foo` 함수가 종료되면 코드의 제어권은 전역 코드로 이동되며, `foo` 함수 실행 컨텍스트도 동시에 제거됨
* 또한, 더 이상 실행할 전역 코드가 남아있지 않으므로 전역 실행 컨텍스트도 스택에서 팝되어 제거됨