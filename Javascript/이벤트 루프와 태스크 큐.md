# 이벤트 루프와 태스크 큐

* 자바스크립트의 특징 중 하나는 싱글 스레드로 동작한다는 것으로, 한 번의 하나의 태스크만 처리 가능함
	* 정확히는 자바스크립트 엔진은 싱글 스레드로 동작하지만, 브라우저는 멀티 스레드로 동작함
* 하지만 여러 작업들을 병렬로 작업 가능한데, 이는 자바스크립트의 동시성을 지원하는 이벤트 루프 덕분임
* 비동기 처리에서 소스의 평가, 실행을 제외한 처리들은 엔진을 구동하는 브라우저 또는 Node.js가 담당함

> 예를 들어, `setTimeout()` 함수의 평가와 실행은 자바스크립트 엔진이 담당하지만, 호출 스케줄링을 위한 타이머 설정과 콜백 함수 등록은 브라우저 또는 Node.js가 담당한다. 이를 위해 브라우저 환경은 태스크 큐와 이벤트 루프를 제공한다.

![](https://velog.velcdn.com/images/jaykim/post/23a53218-5726-468e-bcce-1fd2291beb8a/image.png)

### 콜 스택

* 소스코드 평가 과정에서 생성된 실행 컨텍스트가 추가되고 제거되는 스택 자료구조
* 함수 호출 시 함수 실행 컨텍스트가 푸시되어 실행되며, 상위 요소가 종료되기 전 다른 요소는 실행되지 않음

### 힙

* 객체가 저장되는 메모리 공간으로, 콜 스택의 요소인 실행 컨텍스트가 실질적으로 저장되는 공간임
* 객체는 원시값과 달리 크기가 정해져 있지 않기 때문에 힙은 구조화되어 있지 않다는 특징이 있음

### 태스크 큐

* `setTimeout()`과 같은 비동기 함수의 콜백 함수 또는 이벤트 핸들러가 일시적으로 보관되는 영역
* JS 엔진은 싱글 스레드이지만, 태스크 큐는 브라우저나 Node.js가 관리하기에 여러 개가 존재할 수 있음

### 이벤트 루프

* 콜 스택에 현재 실행 중인 실행 컨텍스트가 있는지, 태스크 큐에 대기 중인 함수가 있는지 반복하여 확인함
* 콜 스택이 비어있고, 태스크 큐에 대기 중인 함수가 있는 경우 태스크 큐의 함수를 콜 스택으로 이동시킴
	* 태스크 큐의 함수는 콜 스택이 비어있는 경우에만 이동되며, 콜 스택으로 이동한 함수는 곧바로 실행됨
